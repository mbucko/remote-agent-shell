{
  "description": "Comprehensive ntfy IP change notification test vectors",
  "version": 1,
  "generated_by": "scripts/generate_ntfy_vectors.py",
  "compatibility_note": "Both daemon (Python) and Android (Kotlin) MUST pass ALL vectors",
  "sections": {
    "topic_derivation": {
      "description": "Topic = 'ras-' + SHA256(master_secret)[:6].hex()",
      "algorithm": "SHA-256, take first 6 bytes, convert to hex, prepend 'ras-'",
      "vectors": [
        {
          "id": "topic_normal",
          "master_secret_hex": "0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef",
          "sha256_full_hex": "4884fdaafea47c29fea7159d0daddd9c085d6200e1359e85bb81736af6b7c837",
          "sha256_first_6_bytes_hex": "4884fdaafea4",
          "expected_topic": "ras-4884fdaafea4"
        },
        {
          "id": "topic_zeros",
          "master_secret_hex": "0000000000000000000000000000000000000000000000000000000000000000",
          "sha256_full_hex": "66687aadf862bd776c8fc18b8e9f8e20089714856ee233b3902a591d0d5f2925",
          "sha256_first_6_bytes_hex": "66687aadf862",
          "expected_topic": "ras-66687aadf862"
        },
        {
          "id": "topic_ones",
          "master_secret_hex": "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",
          "sha256_full_hex": "af9613760f72635fbdb44a5a0a63c39f12af30f950a6ee5c971be188e89c4051",
          "sha256_first_6_bytes_hex": "af9613760f72",
          "expected_topic": "ras-af9613760f72"
        },
        {
          "id": "topic_alternating",
          "master_secret_hex": "aa55aa55aa55aa55aa55aa55aa55aa55aa55aa55aa55aa55aa55aa55aa55aa55",
          "sha256_full_hex": "6e6372a77cfc23170b554daa2b09c62c4dc319a505651eb2d68d925e97a5f04b",
          "sha256_first_6_bytes_hex": "6e6372a77cfc",
          "expected_topic": "ras-6e6372a77cfc"
        }
      ]
    },
    "key_derivation": {
      "description": "HKDF-SHA256 key derivation",
      "algorithm": "HKDF(algorithm=SHA256, length=32, salt=None, info=b'ntfy')",
      "reference": "RFC 5869",
      "vectors": [
        {
          "id": "key_normal",
          "master_secret_hex": "0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef",
          "info": "ntfy",
          "salt": "None (empty)",
          "expected_key_hex": "e3d801b5755b78c380d59c1285c1a65290db0334cc2994dfd048ebff2df8781f"
        },
        {
          "id": "key_zeros",
          "master_secret_hex": "0000000000000000000000000000000000000000000000000000000000000000",
          "info": "ntfy",
          "salt": "None (empty)",
          "expected_key_hex": "85c514bd2626c0875f48c7eb2a2296ad7cb628e3b58565c9826a5bd32691d775"
        },
        {
          "id": "key_ones",
          "master_secret_hex": "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",
          "info": "ntfy",
          "salt": "None (empty)",
          "expected_key_hex": "18c34a3f9d03726aef5006537f38b243bc506f00c4ce72c2b27155ea22224093"
        },
        {
          "id": "key_alternating",
          "master_secret_hex": "aa55aa55aa55aa55aa55aa55aa55aa55aa55aa55aa55aa55aa55aa55aa55aa55",
          "info": "ntfy",
          "salt": "None (empty)",
          "expected_key_hex": "effe34d5d096094ec0e841ad77c88ea6ba6f10a6df174a83a51efb2ef669dddf"
        }
      ]
    },
    "protobuf_serialization": {
      "description": "IpChangeNotification protobuf wire format",
      "fields": {
        "1": "ip (string)",
        "2": "port (uint32)",
        "3": "timestamp (int64)",
        "4": "nonce (bytes, 16 bytes)"
      },
      "wire_format": "Proto3 with varint encoding",
      "vectors": [
        {
          "id": "proto_ipv4_normal",
          "input": {
            "ip": "192.168.1.100",
            "port": 8821,
            "timestamp": 1706384400,
            "nonce_hex": "00112233445566778899aabbccddeeff"
          },
          "expected_bytes_hex": "0a0d3139322e3136382e312e31303010f5441890b8d5ad06221000112233445566778899aabbccddeeff",
          "expected_length": 42
        },
        {
          "id": "proto_ipv6_full",
          "input": {
            "ip": "2001:0db8:85a3:0000:0000:8a2e:0370:7334",
            "port": 8821,
            "timestamp": 1706384400,
            "nonce_hex": "ffeeddccbbaa99887766554433221100"
          },
          "expected_bytes_hex": "0a27323030313a306462383a383561333a303030303a303030303a386132653a303337303a3733333410f5441890b8d5ad062210ffeeddccbbaa99887766554433221100",
          "expected_length": 68
        },
        {
          "id": "proto_ipv6_short",
          "input": {
            "ip": "2001:db8::1",
            "port": 8821,
            "timestamp": 1706384400,
            "nonce_hex": "ffeeddccbbaa99887766554433221100"
          },
          "expected_bytes_hex": "0a0b323030313a6462383a3a3110f5441890b8d5ad062210ffeeddccbbaa99887766554433221100",
          "expected_length": 40
        },
        {
          "id": "proto_ipv6_loopback",
          "input": {
            "ip": "::1",
            "port": 8080,
            "timestamp": 1706384400,
            "nonce_hex": "00000000000000000000000000000000"
          },
          "expected_bytes_hex": "0a033a3a3110903f1890b8d5ad06221000000000000000000000000000000000",
          "expected_length": 32
        },
        {
          "id": "proto_port_zero",
          "input": {
            "ip": "1.2.3.4",
            "port": 0,
            "timestamp": 1706384400,
            "nonce_hex": "00000000000000000000000000000000"
          },
          "expected_bytes_hex": "0a07312e322e332e3410001890b8d5ad06221000000000000000000000000000000000",
          "expected_length": 35
        },
        {
          "id": "proto_port_max",
          "input": {
            "ip": "1.2.3.4",
            "port": 65535,
            "timestamp": 1706384400,
            "nonce_hex": "00000000000000000000000000000000"
          },
          "expected_bytes_hex": "0a07312e322e332e3410ffff031890b8d5ad06221000000000000000000000000000000000",
          "expected_length": 37
        },
        {
          "id": "proto_port_http",
          "input": {
            "ip": "1.2.3.4",
            "port": 80,
            "timestamp": 1706384400,
            "nonce_hex": "00000000000000000000000000000000"
          },
          "expected_bytes_hex": "0a07312e322e332e3410501890b8d5ad06221000000000000000000000000000000000",
          "expected_length": 35
        },
        {
          "id": "proto_port_https",
          "input": {
            "ip": "1.2.3.4",
            "port": 443,
            "timestamp": 1706384400,
            "nonce_hex": "00000000000000000000000000000000"
          },
          "expected_bytes_hex": "0a07312e322e332e3410bb031890b8d5ad06221000000000000000000000000000000000",
          "expected_length": 36
        },
        {
          "id": "proto_timestamp_zero",
          "input": {
            "ip": "1.2.3.4",
            "port": 8821,
            "timestamp": 0,
            "nonce_hex": "00000000000000000000000000000000"
          },
          "expected_bytes_hex": "0a07312e322e332e3410f5441800221000000000000000000000000000000000",
          "expected_length": 32
        },
        {
          "id": "proto_timestamp_epoch",
          "input": {
            "ip": "1.2.3.4",
            "port": 8821,
            "timestamp": 1,
            "nonce_hex": "00000000000000000000000000000000"
          },
          "expected_bytes_hex": "0a07312e322e332e3410f5441801221000000000000000000000000000000000",
          "expected_length": 32
        },
        {
          "id": "proto_timestamp_y2038",
          "input": {
            "ip": "1.2.3.4",
            "port": 8821,
            "timestamp": 2147483647,
            "nonce_hex": "00000000000000000000000000000000"
          },
          "expected_bytes_hex": "0a07312e322e332e3410f54418ffffffff07221000000000000000000000000000000000",
          "expected_length": 36
        },
        {
          "id": "proto_timestamp_y2100",
          "input": {
            "ip": "1.2.3.4",
            "port": 8821,
            "timestamp": 4102444800,
            "nonce_hex": "00000000000000000000000000000000"
          },
          "expected_bytes_hex": "0a07312e322e332e3410f5441880ae99a40f221000000000000000000000000000000000",
          "expected_length": 36
        },
        {
          "id": "proto_nonce_zeros",
          "input": {
            "ip": "1.2.3.4",
            "port": 8821,
            "timestamp": 1706384400,
            "nonce_hex": "00000000000000000000000000000000"
          },
          "expected_bytes_hex": "0a07312e322e332e3410f5441890b8d5ad06221000000000000000000000000000000000",
          "expected_length": 36
        },
        {
          "id": "proto_nonce_ones",
          "input": {
            "ip": "1.2.3.4",
            "port": 8821,
            "timestamp": 1706384400,
            "nonce_hex": "ffffffffffffffffffffffffffffffff"
          },
          "expected_bytes_hex": "0a07312e322e332e3410f5441890b8d5ad062210ffffffffffffffffffffffffffffffff",
          "expected_length": 36
        },
        {
          "id": "proto_nonce_sequential",
          "input": {
            "ip": "1.2.3.4",
            "port": 8821,
            "timestamp": 1706384400,
            "nonce_hex": "000102030405060708090a0b0c0d0e0f"
          },
          "expected_bytes_hex": "0a07312e322e332e3410f5441890b8d5ad062210000102030405060708090a0b0c0d0e0f",
          "expected_length": 36
        },
        {
          "id": "proto_ip_localhost",
          "input": {
            "ip": "127.0.0.1",
            "port": 8821,
            "timestamp": 1706384400,
            "nonce_hex": "00000000000000000000000000000000"
          },
          "expected_bytes_hex": "0a093132372e302e302e3110f5441890b8d5ad06221000000000000000000000000000000000",
          "expected_length": 38
        },
        {
          "id": "proto_ip_broadcast",
          "input": {
            "ip": "255.255.255.255",
            "port": 8821,
            "timestamp": 1706384400,
            "nonce_hex": "00000000000000000000000000000000"
          },
          "expected_bytes_hex": "0a0f3235352e3235352e3235352e32353510f5441890b8d5ad06221000000000000000000000000000000000",
          "expected_length": 44
        },
        {
          "id": "proto_ip_min",
          "input": {
            "ip": "0.0.0.0",
            "port": 8821,
            "timestamp": 1706384400,
            "nonce_hex": "00000000000000000000000000000000"
          },
          "expected_bytes_hex": "0a07302e302e302e3010f5441890b8d5ad06221000000000000000000000000000000000",
          "expected_length": 36
        }
      ]
    },
    "encryption": {
      "description": "AES-256-GCM encryption",
      "format": "base64(iv_12 || ciphertext || tag_16)",
      "warning": "Test vectors use FIXED IV for reproducibility. Production MUST use random IV",
      "production_iv": {
        "python": "os.urandom(12)",
        "kotlin": "SecureRandom().nextBytes(ByteArray(12))"
      },
      "vectors": [
        {
          "id": "encrypt_proto_ipv4_normal",
          "ntfy_key_hex": "e3d801b5755b78c380d59c1285c1a65290db0334cc2994dfd048ebff2df8781f",
          "iv_hex": "000102030405060708090a0b",
          "plaintext_hex": "0a0d3139322e3136382e312e31303010f5441890b8d5ad06221000112233445566778899aabbccddeeff",
          "ciphertext_base64": "AAECAwQFBgcICQoLKgFQ6YTDIcPudAKEF4nzIX/q8NMkiAE+skimC/asnJaC7jSgB0zeSw6pIZFlDAXvu4VmDQbY/w7p7w==",
          "ciphertext_length": 70,
          "input": {
            "ip": "192.168.1.100",
            "port": 8821,
            "timestamp": 1706384400,
            "nonce_hex": "00112233445566778899aabbccddeeff"
          }
        },
        {
          "id": "encrypt_proto_ipv6_full",
          "ntfy_key_hex": "e3d801b5755b78c380d59c1285c1a65290db0334cc2994dfd048ebff2df8781f",
          "iv_hex": "000102030405060708090a0b",
          "plaintext_hex": "0a27323030313a306462383a383561333a303030303a303030303a386132653a303337303a3733333410f5441890b8d5ad062210ffeeddccbbaa99887766554433221100",
          "ciphertext_base64": "AAECAwQFBgcICQoLKitT4IbcKsWyOAuQHoyiArCe2HOsZ5wIoGicIrWtvfnUqosJl8AhpdRGHZ8hxaLx2eCtNw/YN92vi/3DBm4sl6BgHwYMi7E73T40TZLbREOiS0Ih",
          "ciphertext_length": 96,
          "input": {
            "ip": "2001:0db8:85a3:0000:0000:8a2e:0370:7334",
            "port": 8821,
            "timestamp": 1706384400,
            "nonce_hex": "ffeeddccbbaa99887766554433221100"
          }
        },
        {
          "id": "encrypt_proto_ipv6_short",
          "ntfy_key_hex": "e3d801b5755b78c380d59c1285c1a65290db0334cc2994dfd048ebff2df8781f",
          "iv_hex": "000102030405060708090a0b",
          "plaintext_hex": "0a0b323030313a6462383a3a3110f5441890b8d5ad062210ffeeddccbbaa99887766554433221100",
          "ciphertext_base64": "AAECAwQFBgcICQoLKgdT4IbcKpG0YgmQF6k2dZI+UJYxW44ob7Z71m81QUuT/+l9ntUDltKF6vVDNfrgmiEny8I0XA8=",
          "ciphertext_length": 68,
          "input": {
            "ip": "2001:db8::1",
            "port": 8821,
            "timestamp": 1706384400,
            "nonce_hex": "ffeeddccbbaa99887766554433221100"
          }
        },
        {
          "id": "encrypt_proto_port_zero",
          "ntfy_key_hex": "e3d801b5755b78c380d59c1285c1a65290db0334cc2994dfd048ebff2df8781f",
          "iv_hex": "000102030405060708090a0b",
          "plaintext_hex": "0a07312e322e332e3410001890b8d5ad06221000000000000000000000000000000000",
          "ciphertext_base64": "AAECAwQFBgcICQoLKgtQ/oTDI9viSjOytgEWnIyM+EOcXaw4kFimGtSf2MPkmbx7BZ0vMjrd1vh3ogLlV0xq",
          "ciphertext_length": 63,
          "input": {
            "ip": "1.2.3.4",
            "port": 0,
            "timestamp": 1706384400,
            "nonce_hex": "00000000000000000000000000000000"
          }
        },
        {
          "id": "encrypt_proto_port_max",
          "ntfy_key_hex": "e3d801b5755b78c380d59c1285c1a65290db0334cc2994dfd048ebff2df8781f",
          "iv_hex": "000102030405060708090a0b",
          "plaintext_hex": "0a07312e322e332e3410ffff031890b8d5ad06221000000000000000000000000000000000",
          "ciphertext_base64": "AAECAwQFBgcICQoLKgtQ/oTDI9viSsxVJaFTiV8D7mGMXaw4kFimGtSf2MPkmbw5rdL/5PgM/nmZRvA8xYDBvnA=",
          "ciphertext_length": 65,
          "input": {
            "ip": "1.2.3.4",
            "port": 65535,
            "timestamp": 1706384400,
            "nonce_hex": "00000000000000000000000000000000"
          }
        },
        {
          "id": "encrypt_proto_timestamp_zero",
          "ntfy_key_hex": "e3d801b5755b78c380d59c1285c1a65290db0334cc2994dfd048ebff2df8781f",
          "iv_hex": "000102030405060708090a0b",
          "plaintext_hex": "0a07312e322e332e3410f5441800221000000000000000000000000000000000",
          "ciphertext_base64": "AAECAwQFBgcICQoLKgtQ/oTDI9viSsbuPrnhIYqu6EOcXaw4kFimGtSf2MMwEl8VGfKBb9I8DpF+LXe/",
          "ciphertext_length": 60,
          "input": {
            "ip": "1.2.3.4",
            "port": 8821,
            "timestamp": 0,
            "nonce_hex": "00000000000000000000000000000000"
          }
        },
        {
          "id": "encrypt_proto_timestamp_y2038",
          "ntfy_key_hex": "e3d801b5755b78c380d59c1285c1a65290db0334cc2994dfd048ebff2df8781f",
          "iv_hex": "000102030405060708090a0b",
          "plaintext_hex": "0a07312e322e332e3410f54418ffffffff07221000000000000000000000000000000000",
          "ciphertext_base64": "AAECAwQFBgcICQoLKgtQ/oTDI9viSsbuPkY8znWpylOcXaw4kFimGtSf2MPkmbw5dAxG/5+3voAxw3loSnnSGQ==",
          "ciphertext_length": 64,
          "input": {
            "ip": "1.2.3.4",
            "port": 8821,
            "timestamp": 2147483647,
            "nonce_hex": "00000000000000000000000000000000"
          }
        },
        {
          "id": "encrypt_different_key",
          "description": "Same plaintext with different key must produce different ciphertext",
          "ntfy_key_hex": "85c514bd2626c0875f48c7eb2a2296ad7cb628e3b58565c9826a5bd32691d775",
          "iv_hex": "000102030405060708090a0b",
          "plaintext_hex": "0a07312e322e332e3410f5441890b8d5ad06221000000000000000000000000000000000",
          "ciphertext_base64": "AAECAwQFBgcICQoL1ft27OnEB+jDyJphjIMmcUua2itdFdLpNtAlFTCYrTYog5zgNloPH8cgp8A92ZAi5/m2qw=="
        }
      ]
    },
    "decryption": {
      "description": "Decryption must recover original values exactly",
      "test_procedure": [
        "1. Decode base64 to get bytes",
        "2. Extract IV (first 12 bytes)",
        "3. Decrypt remaining bytes with AES-256-GCM",
        "4. Parse protobuf",
        "5. Verify all fields match input"
      ],
      "vectors": [
        {
          "id": "encrypt_proto_ipv4_normal",
          "ntfy_key_hex": "e3d801b5755b78c380d59c1285c1a65290db0334cc2994dfd048ebff2df8781f",
          "iv_hex": "000102030405060708090a0b",
          "plaintext_hex": "0a0d3139322e3136382e312e31303010f5441890b8d5ad06221000112233445566778899aabbccddeeff",
          "ciphertext_base64": "AAECAwQFBgcICQoLKgFQ6YTDIcPudAKEF4nzIX/q8NMkiAE+skimC/asnJaC7jSgB0zeSw6pIZFlDAXvu4VmDQbY/w7p7w==",
          "ciphertext_length": 70,
          "input": {
            "ip": "192.168.1.100",
            "port": 8821,
            "timestamp": 1706384400,
            "nonce_hex": "00112233445566778899aabbccddeeff"
          }
        },
        {
          "id": "encrypt_proto_ipv6_full",
          "ntfy_key_hex": "e3d801b5755b78c380d59c1285c1a65290db0334cc2994dfd048ebff2df8781f",
          "iv_hex": "000102030405060708090a0b",
          "plaintext_hex": "0a27323030313a306462383a383561333a303030303a303030303a386132653a303337303a3733333410f5441890b8d5ad062210ffeeddccbbaa99887766554433221100",
          "ciphertext_base64": "AAECAwQFBgcICQoLKitT4IbcKsWyOAuQHoyiArCe2HOsZ5wIoGicIrWtvfnUqosJl8AhpdRGHZ8hxaLx2eCtNw/YN92vi/3DBm4sl6BgHwYMi7E73T40TZLbREOiS0Ih",
          "ciphertext_length": 96,
          "input": {
            "ip": "2001:0db8:85a3:0000:0000:8a2e:0370:7334",
            "port": 8821,
            "timestamp": 1706384400,
            "nonce_hex": "ffeeddccbbaa99887766554433221100"
          }
        },
        {
          "id": "encrypt_proto_ipv6_short",
          "ntfy_key_hex": "e3d801b5755b78c380d59c1285c1a65290db0334cc2994dfd048ebff2df8781f",
          "iv_hex": "000102030405060708090a0b",
          "plaintext_hex": "0a0b323030313a6462383a3a3110f5441890b8d5ad062210ffeeddccbbaa99887766554433221100",
          "ciphertext_base64": "AAECAwQFBgcICQoLKgdT4IbcKpG0YgmQF6k2dZI+UJYxW44ob7Z71m81QUuT/+l9ntUDltKF6vVDNfrgmiEny8I0XA8=",
          "ciphertext_length": 68,
          "input": {
            "ip": "2001:db8::1",
            "port": 8821,
            "timestamp": 1706384400,
            "nonce_hex": "ffeeddccbbaa99887766554433221100"
          }
        },
        {
          "id": "encrypt_proto_port_zero",
          "ntfy_key_hex": "e3d801b5755b78c380d59c1285c1a65290db0334cc2994dfd048ebff2df8781f",
          "iv_hex": "000102030405060708090a0b",
          "plaintext_hex": "0a07312e322e332e3410001890b8d5ad06221000000000000000000000000000000000",
          "ciphertext_base64": "AAECAwQFBgcICQoLKgtQ/oTDI9viSjOytgEWnIyM+EOcXaw4kFimGtSf2MPkmbx7BZ0vMjrd1vh3ogLlV0xq",
          "ciphertext_length": 63,
          "input": {
            "ip": "1.2.3.4",
            "port": 0,
            "timestamp": 1706384400,
            "nonce_hex": "00000000000000000000000000000000"
          }
        },
        {
          "id": "encrypt_proto_port_max",
          "ntfy_key_hex": "e3d801b5755b78c380d59c1285c1a65290db0334cc2994dfd048ebff2df8781f",
          "iv_hex": "000102030405060708090a0b",
          "plaintext_hex": "0a07312e322e332e3410ffff031890b8d5ad06221000000000000000000000000000000000",
          "ciphertext_base64": "AAECAwQFBgcICQoLKgtQ/oTDI9viSsxVJaFTiV8D7mGMXaw4kFimGtSf2MPkmbw5rdL/5PgM/nmZRvA8xYDBvnA=",
          "ciphertext_length": 65,
          "input": {
            "ip": "1.2.3.4",
            "port": 65535,
            "timestamp": 1706384400,
            "nonce_hex": "00000000000000000000000000000000"
          }
        },
        {
          "id": "encrypt_proto_timestamp_zero",
          "ntfy_key_hex": "e3d801b5755b78c380d59c1285c1a65290db0334cc2994dfd048ebff2df8781f",
          "iv_hex": "000102030405060708090a0b",
          "plaintext_hex": "0a07312e322e332e3410f5441800221000000000000000000000000000000000",
          "ciphertext_base64": "AAECAwQFBgcICQoLKgtQ/oTDI9viSsbuPrnhIYqu6EOcXaw4kFimGtSf2MMwEl8VGfKBb9I8DpF+LXe/",
          "ciphertext_length": 60,
          "input": {
            "ip": "1.2.3.4",
            "port": 8821,
            "timestamp": 0,
            "nonce_hex": "00000000000000000000000000000000"
          }
        },
        {
          "id": "encrypt_proto_timestamp_y2038",
          "ntfy_key_hex": "e3d801b5755b78c380d59c1285c1a65290db0334cc2994dfd048ebff2df8781f",
          "iv_hex": "000102030405060708090a0b",
          "plaintext_hex": "0a07312e322e332e3410f54418ffffffff07221000000000000000000000000000000000",
          "ciphertext_base64": "AAECAwQFBgcICQoLKgtQ/oTDI9viSsbuPkY8znWpylOcXaw4kFimGtSf2MPkmbw5dAxG/5+3voAxw3loSnnSGQ==",
          "ciphertext_length": 64,
          "input": {
            "ip": "1.2.3.4",
            "port": 8821,
            "timestamp": 2147483647,
            "nonce_hex": "00000000000000000000000000000000"
          }
        }
      ]
    },
    "size_validation": {
      "description": "Minimum size validation before decryption",
      "minimum_bytes": 28,
      "breakdown": {
        "iv": 12,
        "tag": 16,
        "minimum_plaintext": 0
      },
      "vectors": [
        {
          "id": "size_0_bytes",
          "input_base64": "",
          "length": 0,
          "valid": false,
          "reason": "Empty"
        },
        {
          "id": "size_1_byte",
          "input_base64": "AA==",
          "length": 1,
          "valid": false,
          "reason": "Too short"
        },
        {
          "id": "size_11_bytes",
          "input_base64": "AAAAAAAAAAAAAAA=",
          "length": 11,
          "valid": false,
          "reason": "Less than IV"
        },
        {
          "id": "size_12_bytes",
          "input_base64": "AAAAAAAAAAAAAAAA",
          "length": 12,
          "valid": false,
          "reason": "IV only, no tag"
        },
        {
          "id": "size_27_bytes",
          "input_base64": "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
          "length": 27,
          "valid": false,
          "reason": "One byte short"
        },
        {
          "id": "size_28_bytes",
          "input_base64": "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==",
          "length": 28,
          "valid": true,
          "reason": "Minimum valid (IV + tag, empty plaintext)"
        },
        {
          "id": "size_29_bytes",
          "input_base64": "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=",
          "length": 29,
          "valid": true,
          "reason": "Minimum + 1 byte plaintext"
        },
        {
          "id": "size_100_bytes",
          "input_base64": "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==",
          "length": 100,
          "valid": true,
          "reason": "Larger payload"
        }
      ]
    },
    "base64_validation": {
      "description": "Base64 decoding validation",
      "vectors": [
        {
          "id": "base64_valid",
          "input": "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==",
          "valid": true
        },
        {
          "id": "base64_with_padding",
          "input": "YWJjZA==",
          "valid": true
        },
        {
          "id": "base64_no_padding",
          "input": "YWJjZA",
          "valid": true,
          "note": "Some decoders accept this"
        },
        {
          "id": "base64_invalid_chars",
          "input": "abc!!!def",
          "valid": false,
          "reason": "Invalid characters"
        },
        {
          "id": "base64_spaces",
          "input": "YWJj ZGVm",
          "valid": false,
          "reason": "Contains space"
        },
        {
          "id": "base64_newlines",
          "input": "YWJj\nZGVm",
          "valid": false,
          "reason": "Contains newline"
        },
        {
          "id": "base64_empty",
          "input": "",
          "valid": true,
          "note": "Empty string is valid base64 (decodes to empty bytes)"
        },
        {
          "id": "base64_unicode",
          "input": "YWJj\u00e9",
          "valid": false,
          "reason": "Non-ASCII character"
        }
      ]
    },
    "decryption_failures": {
      "description": "These decryption attempts MUST fail",
      "vectors": [
        {
          "id": "decrypt_wrong_key",
          "description": "Decryption with wrong key must fail",
          "ciphertext_base64": "AAECAwQFBgcICQoLKgtQ/oTDI9viSsbuPil75CeoylOcXaw4kFimGtSf2MPkmbw5wnQBA2qCCczlxD9ncKV16g==",
          "ntfy_key_hex": "85c514bd2626c0875f48c7eb2a2296ad7cb628e3b58565c9826a5bd32691d775",
          "expected_error": "InvalidTag / AEADBadTagException"
        },
        {
          "id": "decrypt_corrupted_tag",
          "description": "Corrupted auth tag must fail",
          "ciphertext_base64": "AAECAwQFBgcICQoLKgtQ/oTDI9viSsbuPil75CeoylOcXaw4kFimGtSf2MPkmbw5wnQBA2qCCczlxD9ncKV1FQ==",
          "ntfy_key_hex": "e3d801b5755b78c380d59c1285c1a65290db0334cc2994dfd048ebff2df8781f",
          "expected_error": "InvalidTag / AEADBadTagException"
        },
        {
          "id": "decrypt_corrupted_ciphertext",
          "description": "Corrupted ciphertext must fail",
          "ciphertext_base64": "AAECAwQFBgcICQoLKgtQ/oTDI9sdSsbuPil75CeoylOcXaw4kFimGtSf2MPkmbw5wnQBA2qCCczlxD9ncKV16g==",
          "ntfy_key_hex": "e3d801b5755b78c380d59c1285c1a65290db0334cc2994dfd048ebff2df8781f",
          "expected_error": "InvalidTag / AEADBadTagException"
        },
        {
          "id": "decrypt_truncated",
          "description": "Truncated message must fail",
          "ciphertext_base64": "AAECAwQFBgcICQoLKgtQ/oTDI9viSsbuPil75Ceo",
          "ntfy_key_hex": "e3d801b5755b78c380d59c1285c1a65290db0334cc2994dfd048ebff2df8781f",
          "expected_error": "InvalidTag / AEADBadTagException"
        }
      ]
    },
    "timestamp_validation": {
      "description": "Timestamp must be within 300 seconds of current time",
      "window_seconds": 300,
      "formula": "abs(current_time - message_timestamp) <= 300",
      "vectors": [
        {
          "id": "ts_exact_match",
          "message_ts": 1706384400,
          "current_ts": 1706384400,
          "valid": true,
          "delta": 0
        },
        {
          "id": "ts_1_second_ago",
          "message_ts": 1706384399,
          "current_ts": 1706384400,
          "valid": true,
          "delta": 1
        },
        {
          "id": "ts_1_second_future",
          "message_ts": 1706384401,
          "current_ts": 1706384400,
          "valid": true,
          "delta": -1
        },
        {
          "id": "ts_299_seconds_ago",
          "message_ts": 1706384101,
          "current_ts": 1706384400,
          "valid": true,
          "delta": 299
        },
        {
          "id": "ts_300_seconds_ago",
          "message_ts": 1706384100,
          "current_ts": 1706384400,
          "valid": true,
          "delta": 300,
          "note": "Boundary - exactly at limit"
        },
        {
          "id": "ts_301_seconds_ago",
          "message_ts": 1706384099,
          "current_ts": 1706384400,
          "valid": false,
          "delta": 301,
          "reason": "Too old"
        },
        {
          "id": "ts_299_seconds_future",
          "message_ts": 1706384699,
          "current_ts": 1706384400,
          "valid": true,
          "delta": -299
        },
        {
          "id": "ts_300_seconds_future",
          "message_ts": 1706384700,
          "current_ts": 1706384400,
          "valid": true,
          "delta": -300,
          "note": "Boundary - exactly at limit"
        },
        {
          "id": "ts_301_seconds_future",
          "message_ts": 1706384701,
          "current_ts": 1706384400,
          "valid": false,
          "delta": -301,
          "reason": "Too far in future"
        },
        {
          "id": "ts_1_hour_ago",
          "message_ts": 1706380800,
          "current_ts": 1706384400,
          "valid": false,
          "delta": 3600,
          "reason": "Way too old"
        },
        {
          "id": "ts_1_day_ago",
          "message_ts": 1706298000,
          "current_ts": 1706384400,
          "valid": false,
          "delta": 86400,
          "reason": "Way too old"
        }
      ]
    },
    "nonce_replay_detection": {
      "description": "Nonces must be tracked to prevent replay attacks",
      "cache_size": 100,
      "eviction": "FIFO when cache exceeds 100 entries",
      "vectors": [
        {
          "id": "nonce_first_use",
          "nonce_hex": "00112233445566778899aabbccddeeff",
          "seen_before": false,
          "valid": true
        },
        {
          "id": "nonce_second_use",
          "nonce_hex": "00112233445566778899aabbccddeeff",
          "seen_before": true,
          "valid": false,
          "reason": "Replay"
        },
        {
          "id": "nonce_different",
          "nonce_hex": "ffeeddccbbaa99887766554433221100",
          "seen_before": false,
          "valid": true
        },
        {
          "id": "nonce_all_zeros",
          "nonce_hex": "00000000000000000000000000000000",
          "seen_before": false,
          "valid": true
        },
        {
          "id": "nonce_all_zeros_replay",
          "nonce_hex": "00000000000000000000000000000000",
          "seen_before": true,
          "valid": false,
          "reason": "Replay"
        }
      ]
    },
    "ntfy_event_filtering": {
      "description": "Only 'message' events with non-empty message field should be processed",
      "vectors": [
        {
          "id": "event_message",
          "json": "{\"id\":\"abc\",\"time\":123,\"event\":\"message\",\"topic\":\"ras-test\",\"message\":\"encrypted_payload\"}",
          "should_process": true,
          "extract_field": "message"
        },
        {
          "id": "event_open",
          "json": "{\"id\":\"abc\",\"time\":123,\"event\":\"open\",\"topic\":\"ras-test\"}",
          "should_process": false,
          "reason": "Connection event, not a message"
        },
        {
          "id": "event_keepalive",
          "json": "{\"id\":\"abc\",\"time\":123,\"event\":\"keepalive\",\"topic\":\"ras-test\"}",
          "should_process": false,
          "reason": "Keepalive ping, not a message"
        },
        {
          "id": "event_unknown",
          "json": "{\"id\":\"abc\",\"time\":123,\"event\":\"unknown_type\",\"topic\":\"ras-test\"}",
          "should_process": false,
          "reason": "Unknown event type"
        },
        {
          "id": "event_missing",
          "json": "{\"id\":\"abc\",\"time\":123,\"topic\":\"ras-test\"}",
          "should_process": false,
          "reason": "No event field"
        },
        {
          "id": "event_empty_message",
          "json": "{\"id\":\"abc\",\"time\":123,\"event\":\"message\",\"topic\":\"ras-test\",\"message\":\"\"}",
          "should_process": false,
          "reason": "Empty message field"
        },
        {
          "id": "event_missing_message",
          "json": "{\"id\":\"abc\",\"time\":123,\"event\":\"message\",\"topic\":\"ras-test\"}",
          "should_process": false,
          "reason": "No message field"
        }
      ]
    }
  },
  "implementation_requirements": {
    "cryptography": {
      "algorithm": "AES-256-GCM",
      "key_size_bytes": 32,
      "iv_size_bytes": 12,
      "tag_size_bytes": 16,
      "iv_generation": {
        "python": "os.urandom(12)",
        "kotlin": "SecureRandom().nextBytes(ByteArray(12))",
        "warning": "NEVER reuse IV with same key"
      },
      "nonce_generation": {
        "python": "os.urandom(16)",
        "kotlin": "SecureRandom().nextBytes(ByteArray(16))"
      }
    },
    "validation": {
      "timestamp_window_seconds": 300,
      "nonce_cache_max_size": 100,
      "min_encrypted_size_bytes": 28
    },
    "thread_safety": {
      "android_nonce_cache": "Collections.synchronizedSet(LinkedHashSet())"
    },
    "retry_publish": {
      "max_attempts": 3,
      "backoff_delays_ms": [
        1000,
        2000,
        4000
      ]
    },
    "retry_websocket": {
      "max_attempts": 3,
      "backoff_delays_ms": [
        5000,
        10000,
        20000
      ],
      "reset_on": "successful onOpen callback"
    },
    "logging": {
      "info_level": "Sanitized (no IPs, no keys)",
      "debug_level": "Full details allowed"
    }
  }
}